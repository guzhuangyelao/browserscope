#!/usr/bin/python2.4
#
# Copyright 2009 Google Inc.
#
# Licensed under the Apache License, Version 2.0 (the 'License')
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an 'AS IS' BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Handlers for Acid3 Tests.

Example beacon request:
  http://localhost:8080/beacon?category=acid3&results=score=99
"""

__author__ = 'jacobm@google.com (Jacob Moon)'

import time

from categories import all_test_sets
from base import decorators
from base import util

from django import http
from django.template import Context, loader


CATEGORY = 'acid3'


def Render(request, template_file, params):
  """Render Acid3 Benchmark test pages."""

  params['epoch'] = int(time.time())
  return util.Render(request, template_file, params, CATEGORY)

def About(request):
  """About page."""
  params = {
    'page_title': 'Acid3 Test - About',
    'tests': all_test_sets.GetTestSet(CATEGORY).tests,
  }
  return Render(request, 'templates/about.html', params)

@decorators.provide_csrf
def Test(request):
  """Acid3 Benchmark Performance Tests"""
  params = {
    'page_title': 'Acid3 - Tests',
    'continue': request.GET.get('continue'),
    'autorun': request.GET.get('autorun'),
    'csrf_token': request.session.get('csrf_token'),
    'test_page': '/acid3/acid3.html'
  }
  return util.Render(request, util.TEST_DRIVER_TPL, params, CATEGORY)


def SupportAPng(request):
  # AppEngine does not allow disk operations, so the content of support-a.png file is written here.
  content = '\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x00\x96\x00\x00\x00\x96\x08\x02\x00\x00\x00\xb3c\xe6\xb5\x00\x00\x00\x01sRGB\x00\xae\xce\x1c\xe9\x00\x00\x00\x04gAMA\x00\x00\xb1\x8f\x0b\xfca\x05\x00\x00\x00 cHRM\x00\x00z&\x00\x00\x80\x84\x00\x00\xfa\x00\x00\x00\x80\xe8\x00\x00u0\x00\x00\xea`\x00\x00:\x98\x00\x00\x17p\x9c\xbaQ<\x00\x00\x08\x86IDATx^\xed\x9a\xe1\x8e%+\x08\x84\xf7\xbe\xf9\xbe\xf9\xde\x93\x9c\xa4cZ\x85*@\x85\x19\'\xf3\x13\x11\xea\x03\xa4\'\xf3\xdf\xbf?\xf7\xa7\xb8\x02\x1f\x84\xf7\xb7\xb4\x02\x97_y\x05\xca\'P\xba\x81B\x82\xbf\x08\xcb+P>\x81\x90B.\xed\xe4",\xaf@\xf9\x04J7PH\xf0\x17ay\x05\xca\'\x10R\xc8\xa5\x9d\\\x84\xe5\x15(\x9f@\xe9\x06\n\t\xfe",\xaf@\xf9\x04B\n\xb9\xb4\x93\x8b\xb0\xbc\x02\xe5\x13(\xdd@!\xc1_\x84\xe5\x15(\x9f@H!\x97vr\x11\x96W\xa0|\x02\xa5\x1b($\xf8\x8b\xb0\xbc\x02\xe5\x13\x08)d\xd0\xc9\xdf\x94\xffgt\x11\xa2\n|\xf8]\x84\xa8X\xb3\x9e8(\xe2\xf7\xea\x83\x01\x08s\xc2++8\x82\xfcf\x07\x15l\xf9%\xa4X\x03\xe1KD\x7fA\xe0\x1ez~\xd9\xc6i\x01\x84\x07\x9b`\xc8\xef"\xe4\x8a\xe6\xa0\x88\xb3\xab\xb3\xcdRNP|\xfe\x84X\x1e\x14Q\xbe:\x15\xc5\xbc\x08U\x11\xc1*1\xcc=\xf5\xea\x8bP\xaf\x9b\x10\x11{\xa1\x11\xe9\xc1\xab\r\x95\x01\xd6\x1ck\xa6\xab\xc9z\xf4\xdb\xe3"\xcet\x1c~\x81\xbc\xf8\t6x\x00\xfed\xfd\x1e\xd2!\xc4\xe5\x1b\xb6T{\xbcU\x07\xe1\xf7\xb1w\xde\xee\xe7a\xf0\x90\x0ba\xdb\x19\xb8\x9aO\xda\x81\xfc@\x9c\x06\xc5\xc3\x8f$B\xf8\x9al,B\x0f\xbf\xfe.\x10a\x86\x171\x0b\xc2!\x00\x9cb8\xbfo\xaf\x80\x01\x847\x16\xe50\x05\xc2\x19\x00\\\xc4\xd8\xfd\xa5\x7fDe\x96\x94\xe2\xe1\xc6?\n!\xbb\xbf<;\x8e\xbf\x86\xc2\xc1\xe0\x0e\xcf#\x14\xe4\x8b\x9afr\x8f\xca\x01\x80\xb3\xf4\xe0\xa3x\x18\xe1K\xa0Y\xe9\xa9:\n5+|{\xf4%2\xf4\xa3\xde>\xbc\x02o#\xa7\xe5O@\xc8J\xd0*\xae\xce\x00\xf0=fc\x08\xb4?\x89\x10lAy\x9c\xca\x12\xf7J\x19ZJ=\x12\xc8\xc3\xe0\xea\x18\xc2\xe1\xa7\x98:\x0fU5\x87\x06\x8f[\xc3q\xf5=\x16v(\x03\x0f\xc3\x91,\x08\x91\xd0\r\x00\xdaE\xc6|\\\xa0x\x9c\xdf\'\x803\x08\xa9\x11\xca~\xa5\x99Q\t\x07\x87\xe3:\x03\xbf\x14\x08\x91\xfe\xf3L\xc2\x10\xa2\xf2\xee\xfa\xeb6Rd\t\xf4,\xf7!\xccfOuO\xeb,\xbf3]8\xfc\xd0V{q\x11\x18\xdc\xadZUj\n\x8b\x0cv\xbf\x85E\xf9\t\x7f\x1f\xf8u]hHX\xdd}\xf0N\xfaXz\x96\xa3\xd9\xd9W{\x19r\xf44\xe8\xee.dc\xc5?\x1f\x11\x90\xb3\xdb\x91\xb3-~\xe19\xdf\xcc\xef\xcc[\x88S\x1c*k\xfe\xfc\x97\xefE(\xca{\xe9\xf3\xe1\x81\'\x18b\x99\xb7\x0bg\x9a.B8\xfc\xf2\xebgx\xaa\xfe\xfbJq\x00\xe1\xebAb\x87\x9b\xb9\x99\xd4\x92\x97\x1b\xf1\xc5x\xf8\xfe\x81\xa9\xa9\x91P\x06\xbb\x11\xe2I\xb2]\xf8\xf5,`\x98}\x15\x80\x0bN\xeb<\x0f\xbf\xad]H\xbd\xf3jC\xccD\xa4\x10\xf6!Q\xc7\xd5\xa7\x91j&\xb3\xf1\xa6.\xa4\xf8\xa9\xcf\x92\x81_\xdf\xfd\xb3]\x97\xda\xa1\x84\xa7\xd1\x8c\x84=\xb8\x03!\xcbOE8\xdb\xef\xf1\xde\x15\xa64\x8e0\x03\xbf\x1d\x83\xd4\xc0\x0fA\xa8\xbe|\xb3&\x03\x9d#x\x1e\x1ba#c[\xca`\xbf\xb6\x0bm\xfc\x0c*\xcb\xfd\xd7j\xadv\xea\xcb@]\x98e\x03\x03\x12\xf6\xc8B\x84f~\xeb\x10\xaa\xfc\xe4/\x87G\\\xa4\xff\xfa\xd7\x97e\x03\xda\xafB8\xe4\xa7f\xdek\x04\xb6\x97\xdf\x8cZ/\xe5\xea\xf4\xd4.\x88\xad5[\x82\xd0\xc9o\x7f\x17\xe2\xed\xf5\xc4v|~>\x01\xc4#\xf4\xf3\xeb\x1b\x02l\xb2(\xf6\x86Vx\xc5l\xf6`8\x18\x8c0\x8a\x9f\r\x86\xed\x14\xb8\xbf\xa8\xe2\xe2\xcfD\xec\x06\x1b\x890\x90\x9f\xb9\x11\xc1~\x15\xbe\x0bUTC\x03\'?\xcf\xf3\x19\x89\xb0\xcf\xcd\x99XHW\xe1Pm\xf0\xda _\x1e\xd4\xa5\x14\xf9\xfaT\xa3Z\x88\xd0\xcf\xaf\x8d\x1e\'a\xb3T\x95\x92\xf7\x97\x9e\x96\xdaX!\xfc>Q\xadBx\xf9\t-\x18\xf5\xfa~\xabj\tB\xb5\x00\xa9\x92\xb7u\x15~\x8a\nf8\x18\xfa\xf9\xf9\xe2\'\x04c\xbe}\xf7G\x853P\x9c\x07e\x19\x12\xd5\x90_\x8bp)?o\x17R\x0f\x80\xb95)*\xa0\xb1\x13\x9e\xfa.>\xca\xac\xe6\xe7BH!\xa1\x8c\x9d[\xccs|\x83|\xe6P\x03k\xc8\xf8\x16R\xdb\x8a\x99\x9f\xfaQ!\x0b1C\x18(\x1fR.\xb1\xcbK\x1f\xbc\x05!\x15\x93\x87\xdf\n\x84\xa7\xf8\xad\xb8\xd7\xb8\x91R\xa5\xed\xe4\x97\r\xe1\xec;A}\x80\xd7\xf1\xa3\xdfB*V?\xbfp\x84\x1e)\x87o\x07%\x88\xe7v\xe1,1H\xd5p{\x03\x7f\xd0\xea\xa5\xc2\x15\xd4\xc0\xc7\x9fU\xf9\xfd\xf3\xa7\xccz@\x11\xaaR\x0e\r\xd8hz{\xf5^\x10\xa1\'\x92a)\xa8\xf9\xce\xa6\xae\'\x92\xe1Y\x08\xa1\xaa\xe3\xba\xf5]\xbd\x1aA\xe8QM\r@\x18\xb0\x9e{\xf1\xb3\xcb\x11:\xa7\x19\xa2\xe00[\xea\xb3g\xa6\x17r{\xdfm!K@^\x84\x86\xf4@\x1d\xd5\xc9\x86\x8b\xf2\xb5D\xee\x9dM~\xf6.\x8f=\xd4\x85`>H\xce\x86\xa64\xb85\x14\xcaKD\xf9R\xb9k=<\x0cgQ\x84xa\x9a\x15\x9f\xe9nvh\x90\x03I3\x15\xbfO0\x1cB$C\xb3\xe2\xfdA\xe7u\xdf\xe1a\x00ih\xc1\xfe\xe9\xb5]m\x88\xd6\x92\xe1sM \xadu\xae(Q\x900f\xef_\xcb\xcc\xf0^Pq\xb6\xc6.\x84\xce.A\xf4\xf2\xdb\x80\xd2\xf8/\xf2{\x00C}\x99\x05 \\\xb7\xec\xf8EA\xa6Y\xc8-\x8b\x9c Pc\x10f\x1e\xad\xb2\n\x8b\xa4\x0fw+d\x11\x89\xf0\xb5R\x86\xa7\xd1?0\xe0\x15\xf2\x0e\t:9h&Wa$B\xea\xd3\xca\xa9\x08\xf5\x0c\x0f%p\x06\xb0\xed\xb8:K9\x84\xdb\xe2\xc6\xd7z$$a\x87D\x8e\x1f\xb4Q\xf9q\xdf\x85\x073i\xaf6\xf4\xbap\x84\xea\xe6\xcd\n \xfc\x08\x84\x9b\xa3\x9f]g\xeb\xa7\xf6\xd4\xe39\xf3\n\x86,\xd2O\xfc\xd0 M\xcb\x0f\xef\xa1\xd6rH\x14\x1f\xddC\xf6`\xc7\x80\x1f`\xb87\xa8\x0b\x93\xf3\x03E\x19\xd65\x9b\xda\x8c=\xa5\xb8:HXoJ\x17\xb2IR\xf6\xa0\xfajJ\xf8\xa5/\x06x\x13\x0b\xdf3jx\xab\r$\x84\xb84\x94%;\xc7\x10\t\xf0\x00\x0c\xdb\x90\xe0\xfc5T\x91P\xc3m\xa6\x08qQ\x90\xd5\xa3_"\xa8\x0eP\xd3\xf6G\xeb\xf7\xa0\x06\xb9\xc8\x00Zg\x9cw\xcf\xf8\x05R\xf4\x03\x88\xf2\xe0\xd4\xcap|9\xc2\x10~\xb2\x13\xf0M\x8d\x82\x84\xf81\x900\x1fY\x8b\xf0\x9b\xed08D\x88\x9facf\x03\x1e\\\x88p\xc6/\'\x98=\xad\x0cR\xa1\xcc\x16",\xd4|\xec\x92\x1cR\x85\x14\'\xc1x\x1f\xc2a\xda\xd4F\xa3\ng\xf36SG\xbd.\xdc\xc0\x06u\x07B\xea\xab\xc3\xac\x0b\xdeI\xacR\xe6\x90\xa8\x83lT\x8f\xfd*\x84j\xf4\xb8\xe2\xaa\xab\xd9\xc6d\x16\xa5?\x88\xc4\xe0\xb1\xf1\x84\x1a\x8c\x10Lc\xc8\xcf\xbcPx\xf2G\xce\xb6I\xd9f\xb5,\x0b\x12\xc3\xf2\xb7\x10$\xd7\xef\xa8\xc3\x0f>\xc4\x9b3m\xfcx\xcf\xef9\x8b\xc4\xa9\xda\xe0\x91\xcc,\x03\xbaP\x8dR\xfd\xbaP\x17\n\x7f\x9e6\x0f\x02\xbf\x97CP\x84\x97\x99-\xaa\xd7)/BdD\x0c\xdf\xaaa\xff\xcd\x06\xac\xc0\x98RaVLC\'j\x84j\xe5!\xe2P\xf1\x0f\x8d]\x08\xcd!\xaa\xeax\x0cf\xdb\x8d\xca\xaf\xbdT\r\x00\x94~&\x11x\x1c1\xb3#\x14\xf8\xc9\x17SR\xb2\xfd\x91\x8a\x1f\x02\xc0ocD\xe8)\xae\x99\xca\xafeO\x1dS\xbd\xc1/\xe4\xf7\x11\xc1\x82p\xc5\x9b\x1c\xc2Oxt\x85b_1?\xfd\xbd\x85{\xa0\x11F=\x12\xc3\x1e\x92g\xacp\xb5\xbc\xf4\x82\xfc>f\xea\x90\xc7\x95\xddf\xc9!\\\x97\xa1\xea\xf9\xf2\x9b\xd5\x04\x87pQee\xe0\xb7(\xb5\rnS D6X\xea\x9d\xf3\xd4\xc4\x06\xd1c\xaf\xc8\x8e\xd06?\x91\x9a\x88\xd5\xf1\xa0\xb7\xd4\x08W\xf0\xfb\xee,\x07\x15\x0f\xbf:o2\x8b\xf8\x85+x\xdcav\x84\xb3o\x8f\xe3\xc2\xe5\t /\xc2<\x1a%\x8f\xe4",\xaf@\xf9\x04\x92\xb7\xc8\x86\xf0.\xc2\xf2\n\x94O`C\x99\'\xbf\xe2",\xaf@\xf9\x04\x92\xb7\xc8\x86\xf0.\xc2\xf2\n\x94O`C\x99\'\xbf\xe2",\xaf@\xf9\x04\x92\xb7\xc8\x86\xf0.\xc2\xf2\n\x94O`C\x99\'\xbf\xe2",\xaf@\xf9\x04\x92\xb7\xc8\x86\xf0.\xc2\xf2\n\x94O`C\x99\'\xbf\xe2",\xaf@\xf9\x04\x92\xb7\xc8\x86\xf0.\xc2\xf2\n\x94O`C\x99\'\xbf\xe2",\xaf@\xf9\x04\x92\xb7\xc8\x86\xf0.\xc2\xf2\n\x94O`C\x99\'\xbf\xe2",\xaf@\xf9\x04\x92\xb7\xc8\x86\xf0\xfe\x07\xae,i\x82\xf4Is\xb4\x00\x00\x00\x00IEND\xaeB`\x82'
  status = 404
  content_type = 'image/png'
  return http.HttpResponse(
      content=content, status=status, content_type=content_type)
