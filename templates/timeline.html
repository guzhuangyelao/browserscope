{% extends "base.html" %}

{% block body %}

<div id="container"></div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
<script src="/static/highcharts.js"></script>
<script>
var chart;
$(document).ready(function() {
    chart = new Highcharts.Chart({
        chart: {
          renderTo: 'container',
          zoomType: 'x',
          type: 'spline'
        },
        title: {
          text: 'Browserscope {{ category }} Timeline'
        },
        subtitle: {
         text: document.ontouchstart === undefined ?
            'Click and drag in the plot area to zoom in' :
            'Drag your finger over the plot to zoom in'
        },
        xAxis: {
          type: 'datetime',
          maxZoom: 90 * 24 * 3600000 // 90 days
          /*
          dateTimeLabelFormats: { // don't display the dummy year
            month: '%b %e',
            year: '%b'
          }*/
        },
        yAxis: {
          title: {
            text: 'Score'
          },
          min: 0,
          max: 100
        },
        tooltip: {
          formatter: function() {
            return '<b>'+ this.point.v + '</b><br/>'+
            Highcharts.dateFormat('%b %e', this.x) +': '+ this.y;
          }
        },
        /*
        plotOptions: {
          spline: {
            dataLabels: {
              enabled: true,
              formatter: function() {
                return this.point.v;
              }
            },
            enableMouseTracking: false
          }
        },
        */
        series: [
          {% for family, version_data in timeline_stats_dict.items %}
            {
              name: '{{ family }}',
              data: [
                {% for data in version_data %}
                  {
                    x: Date.UTC({{ data.release_date.year }}, {{ data.release_date.month|add:"-1" }}, {{ data.release_date.day }}),
                    y: {{ data.score }},
                    v: '{{ data.family_version }}'
                  }{% if forloop.last %}{% else %},{% endif %}
                {% endfor %}
              ]
            }{% if forloop.last %}{% else %},{% endif %}
          {% endfor %}
        ]
    });


});
</script>

{# {{ timeline_stats_dict }} #}

{% comment %}
<script src="http://www.google.com/jsapi"></script>
<script>
google.load('visualization', '1', {packages: ['annotatedtimeline']});
google.setOnLoadCallback(initialize);

function initialize() {
var query = new google.visualization.Query(
"/timeline_data?category={{ category }}&ua={{ ua }}&v=3&o=gviz_timeline_data&tqx=reqId:0");
query.send(draw);
}

function draw(response) {
if (response.isError()) {
alert('Error in query');
}
var data = response.getDataTable()

var chart = new google.visualization.AnnotatedTimeLine(
document.getElementById('visualization'));
chart.draw(data, {
{% ifequal category "summary" %}
'min': 0, 'max': 100,
{% endifequal %}
'displayAnnotations': true,
'annotationsWidth': 35,
'displayAnnotationsFilter': true,
'displayLegendDots': false,
'displayLegendValues': false,
'displayRangeSelector' : true,
'displayZoomButtons': true,
'legendPosition': 'newRow',
'thickness': 2,
'zoomStartTime': new Date(2008, 1 ,1)
});
}
</script>


<div id="visualization" style="width: 1100px; height: 600px;"
>Loading the timeline ...</div>

{% endcomment %}


{% endblock %}

